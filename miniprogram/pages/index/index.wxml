<!--é¦–é¡µ - ç°ä»£åŒ–è®¾è®¡-->
<view class="page-content">
  <view class="container fade-in">
    <!-- æ¬¢è¿æ¨ªå¹… -->
    <view class="welcome-banner">
      <view class="welcome-content">
        <view class="welcome-title">ğŸ“ˆ è€åˆ˜æŠ•èµ„å†³ç­–</view>
        <view class="welcome-subtitle">æ™ºèƒ½é€‰è‚¡ Â· ä»·å€¼æŠ•èµ„</view>
      </view>
      <view class="welcome-decoration"></view>
    </view>

    <!-- æ¯æ—¥æŠ•èµ„é‡‘å¥ -->
    <view class="card slide-up" wx:if="{{dailyQuote}}">
      <view class="card-header">
        <view class="flex">
          <text class="header-icon">ğŸ’</text>
          <text>æ¯æ—¥æŠ•èµ„é‡‘å¥</text>
        </view>
        <view class="quote-meta" bindtap="viewAllQuotes">
          <text class="text-sm">æŸ¥çœ‹å…¨éƒ¨</text>
          <text class="arrow">â€º</text>
        </view>
      </view>
      <view class="card-body">
        <quote-card 
          quote="{{dailyQuote}}" 
          card-style="compact"
          show-share="{{false}}"
          bind:tap="onQuoteTap">
        </quote-card>
      </view>
    </view>

    <!-- å¸‚åœºæ¦‚å†µ -->
    <view class="card slide-up">
      <view class="card-header">
        <view class="flex-between">
          <view class="flex">
            <text class="header-icon">ğŸ“Š</text>
            <text>å¸‚åœºæ¦‚å†µ</text>
          </view>
          <text class="text-sm" wx:if="{{marketData.update_time}}">{{marketData.update_time}}</text>
        </view>
      </view>
      <view class="card-body">
        <view class="market-dashboard">
          <view class="market-item">
            <view class="market-icon">ğŸ’¹</view>
            <view class="market-info">
              <view class="market-label">å¸‚åœºæƒ…ç»ª</view>
              <view class="market-value">
                <text class="tag {{marketData.sentiment === 'bullish' ? 'tag-success' : marketData.sentiment === 'bearish' ? 'tag-danger' : 'tag-info'}}">
                  {{marketData.sentiment === 'bullish' ? 'ğŸ‚ ä¹è§‚' : marketData.sentiment === 'bearish' ? 'ğŸ» æ‚²è§‚' : 'ğŸ˜ ä¸­æ€§'}}
                </text>
              </view>
            </view>
          </view>
          
          <view class="market-item">
            <view class="market-icon">âš–ï¸</view>
            <view class="market-info">
              <view class="market-label">å»ºè®®ä»“ä½</view>
              <view class="market-value text-2xl text-primary">{{marketData.position}}æˆ</view>
            </view>
          </view>
        </view>
        
        <view class="market-signals mt-30" wx:if="{{marketData.signals.length > 0}}">
          <view class="signals-title">
            <text class="signals-icon">ğŸ””</text>
            <text>å¸‚åœºä¿¡å·</text>
          </view>
          <view class="signal-item fade-in" wx:for="{{marketData.signals}}" wx:key="index">
            <text class="signal-dot">â€¢</text>
            <text class="signal-text">{{item}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ä»Šæ—¥æ¨è -->
    <view class="card slide-up">
      <view class="card-header">
        <view class="flex-between">
          <view class="flex">
            <text class="header-icon">â­</text>
            <text>ä»Šæ—¥æ¨è</text>
          </view>
          <text class="text-sm">å…±{{summary.recommendations_count.total}}åª</text>
        </view>
      </view>
      <view class="card-body">
        <view class="recommend-tabs">
          <view class="tab-item {{currentTab === 0 ? 'active' : ''}}" bindtap="switchTab" data-tab="0">
            <text class="tab-icon">ğŸ‡¨ğŸ‡³</text>
            <text>Aè‚¡ ({{summary.recommendations_count.a_stocks}})</text>
          </view>
          <view class="tab-item {{currentTab === 1 ? 'active' : ''}}" bindtap="switchTab" data-tab="1">
            <text class="tab-icon">ğŸ‡­ğŸ‡°</text>
            <text>æ¸¯è‚¡ ({{summary.recommendations_count.hk_stocks}})</text>
          </view>
        </view>
        
        <!-- Aè‚¡æ¨è -->
        <view wx:if="{{currentTab === 0}}" class="stocks-container">
          <view class="stock-item fade-in" wx:for="{{summary.top_picks.a_stocks}}" wx:key="code" bindtap="viewStock" data-stock="{{item}}">
            <view class="stock-avatar">
              <text class="stock-initial">{{item.name.substr(0,1)}}</text>
            </view>
            <view class="stock-info">
              <view class="stock-name">{{item.name}}</view>
              <view class="stock-meta">
                <text class="stock-code">{{item.code}}</text>
                <text class="score {{item.total_score >= 0.7 ? 'score-high' : item.total_score >= 0.5 ? 'score-medium' : 'score-low'}}">
                  è¯„åˆ†: {{item.total_score}}
                </text>
              </view>
            </view>
            <view class="stock-action">
              <view class="price">Â¥{{item.current_price}}</view>
              <view class="recommendation {{getRecommendationClass(item.recommendation)}}">
                <text>{{getRecommendationText(item.recommendation)}}</text>
              </view>
            </view>
          </view>
        </view>

        <!-- æ¸¯è‚¡æ¨è -->
        <view wx:if="{{currentTab === 1}}" class="stocks-container">
          <view class="stock-item fade-in" wx:for="{{summary.top_picks.hk_stocks}}" wx:key="code" bindtap="viewStock" data-stock="{{item}}">
            <view class="stock-avatar">
              <text class="stock-initial">{{item.name.substr(0,1)}}</text>
            </view>
            <view class="stock-info">
              <view class="stock-name">{{item.name}}</view>
              <view class="stock-meta">
                <text class="stock-code">{{item.code}}</text>
                <text class="score {{item.total_score >= 0.7 ? 'score-high' : item.total_score >= 0.5 ? 'score-medium' : 'score-low'}}">
                  è¯„åˆ†: {{item.total_score}}
                </text>
              </view>
            </view>
            <view class="stock-action">
              <view class="price">HK${{item.current_price}}</view>
              <view class="recommendation {{getRecommendationClass(item.recommendation)}}">
                <text>{{getRecommendationText(item.recommendation)}}</text>
              </view>
            </view>
          </view>
        </view>

        <view class="more-action mt-30">
          <view class="btn btn-primary" bindtap="viewMoreStocks">
            <text class="btn-icon">ğŸ‘ï¸</text>
            <text>æŸ¥çœ‹æ›´å¤šæ¨è</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æŠ•èµ„å»ºè®® -->
    <view class="card slide-up" wx:if="{{summary.investment_suggestions.length > 0}}">
      <view class="card-header">
        <view class="flex">
          <text class="header-icon">ğŸ’¡</text>
          <text>æŠ•èµ„å»ºè®®</text>
        </view>
      </view>
      <view class="card-body">
        <view class="suggestions-list">
          <view class="suggestion-item fade-in" wx:for="{{summary.investment_suggestions}}" wx:key="index">
            <view class="suggestion-icon">ğŸ’¼</view>
            <text class="suggestion-text">{{item}}</text>
          </view>
        </view>
        
        <view class="risk-assessment mt-30">
          <view class="risk-header">
            <text class="risk-icon">âš ï¸</text>
            <text class="risk-title">é£é™©è¯„ä¼°</text>
          </view>
          <view class="risk-content">
            <text class="risk-label">å½“å‰é£é™©ç­‰çº§: </text>
            <text class="tag {{summary.portfolio_risk === 'low' ? 'tag-success' : summary.portfolio_risk === 'high' ? 'tag-danger' : 'tag-warning'}}">
              {{summary.portfolio_risk === 'low' ? 'ğŸŸ¢ ä½é£é™©' : summary.portfolio_risk === 'high' ? 'ğŸ”´ é«˜é£é™©' : 'ğŸŸ¡ ä¸­ç­‰é£é™©'}}
            </text>
          </view>
        </view>
      </view>
    </view>

    <!-- å…è´£å£°æ˜ -->
    <view class="disclaimer-card">
      <view class="disclaimer-content">
        <view class="disclaimer-icon">âš–ï¸</view>
        <view class="disclaimer-text">
          <text class="disclaimer-title">å…è´£å£°æ˜</text>
          <text class="disclaimer-desc">
            æœ¬ç³»ç»ŸåŸºäºå†å²æ•°æ®å’Œä¸ªäººç»éªŒï¼Œä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚æŠ•èµ„æœ‰é£é™©ï¼Œå…¥å¸‚éœ€è°¨æ…ã€‚
          </text>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-overlay" wx:if="{{loading}}">
  <view class="loading-content">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ­£åœ¨åŠ è½½æ•°æ®...</text>
  </view>
</view>

<!-- é”™è¯¯æç¤º -->
<view class="error-overlay" wx:if="{{error}}">
  <view class="error-content">
    <view class="error-icon bounce">âš ï¸</view>
    <view class="error-title">æ•°æ®åŠ è½½å¤±è´¥</view>
    <view class="error-message">{{error}}</view>
    <view class="error-actions mt-30">
      <text class="btn btn-primary" bindtap="loadData">é‡æ–°åŠ è½½</text>
    </view>
  </view>
</view>
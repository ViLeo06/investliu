<view class="page-content">
  <view class="container">
    <!-- 市场切换 -->
    <view class="market-tabs">
      <view class="tab {{selectedMarket === 'a' ? 'active' : ''}}" bindtap="switchMarket" data-market="a">
        A股
      </view>
      <view class="tab {{selectedMarket === 'hk' ? 'active' : ''}}" bindtap="switchMarket" data-market="hk">
        港股
      </view>
    </view>

    <!-- 搜索框 -->
    <view class="search-bar">
      <view class="search-input-wrapper">
        <text class="search-icon">🔍</text>
        <input class="search-input" placeholder="搜索股票代码/名称/行业" bindinput="onSearchInput" value="{{searchKeyword}}" />
      </view>
    </view>

    <!-- 筛选按钮和统计信息 -->
    <view class="filter-bar">
      <view class="stats-info">
        <text class="stats-text">共{{totalCount}}只股票，显示{{filteredCount}}只</text>
      </view>
      <view class="filter-btn" bindtap="toggleFilters">
        <text class="icon">🔍</text>
        <text>筛选</text>
      </view>
    </view>

    <!-- 快速筛选按钮 -->
    <view class="quick-filters">
      <scroll-view class="quick-filters-scroll" scroll-x="true">
        <view class="quick-filter-item" bindtap="quickFilter" data-type="high_roe">
          <text>📊 高ROE</text>
        </view>
        <view class="quick-filter-item" bindtap="quickFilter" data-type="low_pe">
          <text>💰 低估值</text>
        </view>
        <view class="quick-filter-item" bindtap="quickFilter" data-type="strong_buy">
          <text>⭐ 强推</text>
        </view>
        <view class="quick-filter-item" bindtap="quickFilter" data-type="high_score">
          <text>🎆 高分</text>
        </view>
      </scroll-view>
    </view>

    <!-- 筛选条件面板 -->
    <view class="filters-panel {{showFilters ? 'show' : ''}}">
      <view class="filter-row">
        <text class="filter-label">价格区间:</text>
        <input class="filter-input" placeholder="最低价" type="digit" bindinput="onFilterInput" data-field="minPrice" value="{{filters.minPrice}}" />
        <text class="separator">-</text>
        <input class="filter-input" placeholder="最高价" type="digit" bindinput="onFilterInput" data-field="maxPrice" value="{{filters.maxPrice}}" />
      </view>
      
      <view class="filter-row">
        <text class="filter-label">PE区间:</text>
        <input class="filter-input" placeholder="最小PE" type="digit" bindinput="onFilterInput" data-field="minPE" value="{{filters.minPE}}" />
        <text class="separator">-</text>
        <input class="filter-input" placeholder="最大PE" type="digit" bindinput="onFilterInput" data-field="maxPE" value="{{filters.maxPE}}" />
      </view>
      
      <view class="filter-row">
        <text class="filter-label">最小ROE:</text>
        <input class="filter-input" placeholder="ROE%" type="digit" bindinput="onFilterInput" data-field="minROE" value="{{filters.minROE}}" />
      </view>
      
      <view class="filter-row">
        <text class="filter-label">行业:</text>
        <picker class="filter-picker" bindchange="onFilterInput" data-field="industry" range="{{industryOptions}}" value="{{filters.industry}}">
          <view class="picker-text">{{filters.industry || '选择行业'}}</view>
        </picker>
      </view>
      
      <view class="filter-row">
        <text class="filter-label">推荐等级:</text>
        <picker class="filter-picker" bindchange="onFilterInput" data-field="recommendation" range="{{recommendationOptions}}" value="{{filters.recommendation}}">
          <view class="picker-text">{{filters.recommendation || '选择等级'}}</view>
        </picker>
      </view>
      
      <view class="filter-row">
        <text class="filter-label">最低评分:</text>
        <input class="filter-input" placeholder="评分" type="digit" bindinput="onFilterInput" data-field="minScore" value="{{filters.minScore}}" />
      </view>
      
      <view class="filter-actions">
        <button class="btn btn-secondary btn-small" bindtap="clearFilters">清空</button>
        <button class="btn btn-primary btn-small" bindtap="applyFilters">应用</button>
      </view>
    </view>

    <!-- 股票列表 -->
    <view class="stock-list">
      <view wx:if="{{loading}}" class="loading">
        <view class="loading-spinner"></view>
        <text>加载中...</text>
      </view>
      
      <view wx:elif="{{error}}" class="empty">
        <view class="empty-icon">📊</view>
        <text class="empty-text">{{errorMessage || '暂无股票数据'}}</text>
        <button class="btn btn-primary import-btn" bindtap="importLatestData">
          <text class="btn-icon">⬇️</text>
          <text>一键导入股票数据</text>
        </button>
        <view class="import-tips">
          <text>• 实时获取最新股价和财务数据</text>
          <text>• 包含老刘评分和投资建议</text>
          <text>• 支持A股和港股市场</text>
        </view>
      </view>
      
      <view wx:elif="{{stockList.length === 0}}" class="empty">
        <view class="empty-icon">📊</view>
        <text class="empty-text">当前筛选条件下暂无数据</text>
        <button class="btn btn-secondary" bindtap="clearFilters">清除筛选</button>
        <button class="btn btn-primary import-btn" bindtap="importLatestData">
          <text class="btn-icon">⬇️</text>
          <text>导入更多数据</text>
        </button>
      </view>
      
      <view wx:else>
        <!-- 数据操作栏 -->
        <view class="data-actions">
          <view class="data-summary">
            <text class="summary-text">已加载 {{stockList.length}} / {{totalCount}} 只股票</text>
          </view>
          <button class="btn btn-outline refresh-btn" bindtap="importLatestData">
            <text class="btn-icon">🔄</text>
            <text>刷新数据</text>
          </button>
        </view>

        <view class="stock-item" wx:for="{{stockList}}" wx:key="code" bindtap="viewStockDetail" data-stock="{{item}}">
          <view class="stock-info">
            <view class="stock-name-row">
              <view class="stock-name">{{item.name}}</view>
              <view class="stock-code">{{item.code}}</view>
            </view>
            <view class="stock-tags">
              <text class="tag tag-info" wx:if="{{item.industry}}">{{item.industry}}</text>
              <text class="score {{item.scoreClass}}">{{item.displayScore}}分</text>
              <text class="tag {{item.recommendationClass}}" wx:if="{{item.displayRecommendation}}">{{item.displayRecommendation}}</text>
            </view>
            <view class="stock-metrics" wx:if="{{item.pe_ratio || item.roe}}">
              <text class="metric" wx:if="{{item.pe_ratio}}">PE: {{item.pe_ratio}}</text>
              <text class="metric" wx:if="{{item.roe}}">ROE: {{item.roe}}%</text>
            </view>
          </view>
          
          <view class="stock-price">
            <view class="price {{item.changeClass}}">
              ¥{{item.displayPrice}}
            </view>
            <view class="change {{item.changeClass}}">
              {{item.displayChange >= 0 ? '+' : ''}}{{item.displayChange}}%
            </view>
            <view class="recommendation {{item.recommendationClass}}">
              {{item.displayRecommendation}}
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 刷新提示 -->
    <view wx:if="{{refreshing}}" class="refresh-indicator">
      <text>刷新中...</text>
    </view>
  </view>
</view>
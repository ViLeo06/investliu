<view class="page-content">
  <view class="container">
    <!-- å¸‚åœºåˆ‡æ¢ -->
    <view class="market-tabs">
      <view class="tab {{selectedMarket === 'a' ? 'active' : ''}}" bindtap="switchMarket" data-market="a">
        Aè‚¡
      </view>
      <view class="tab {{selectedMarket === 'hk' ? 'active' : ''}}" bindtap="switchMarket" data-market="hk">
        æ¸¯è‚¡
      </view>
    </view>

    <!-- æœç´¢æ¡† -->
    <view class="search-bar">
      <view class="search-input-wrapper">
        <text class="search-icon">ğŸ”</text>
        <input class="search-input" placeholder="æœç´¢è‚¡ç¥¨ä»£ç /åç§°/è¡Œä¸š" bindinput="onSearchInput" value="{{searchKeyword}}" />
      </view>
    </view>

    <!-- ç­›é€‰æŒ‰é’®å’Œç»Ÿè®¡ä¿¡æ¯ -->
    <view class="filter-bar">
      <view class="stats-info">
        <text class="stats-text">å…±{{totalCount}}åªè‚¡ç¥¨ï¼Œæ˜¾ç¤º{{filteredCount}}åª</text>
      </view>
      <view class="filter-btn" bindtap="toggleFilters">
        <text class="icon">ğŸ”</text>
        <text>ç­›é€‰</text>
      </view>
    </view>

    <!-- å¿«é€Ÿç­›é€‰æŒ‰é’® -->
    <view class="quick-filters">
      <scroll-view class="quick-filters-scroll" scroll-x="true">
        <view class="quick-filter-item" bindtap="quickFilter" data-type="high_roe">
          <text>ğŸ“Š é«˜ROE</text>
        </view>
        <view class="quick-filter-item" bindtap="quickFilter" data-type="low_pe">
          <text>ğŸ’° ä½ä¼°å€¼</text>
        </view>
        <view class="quick-filter-item" bindtap="quickFilter" data-type="strong_buy">
          <text>â­ å¼ºæ¨</text>
        </view>
        <view class="quick-filter-item" bindtap="quickFilter" data-type="high_score">
          <text>ğŸ† é«˜åˆ†</text>
        </view>
      </scroll-view>
    </view>

    <!-- ç­›é€‰æ¡ä»¶é¢æ¿ -->
    <view class="filters-panel {{showFilters ? 'show' : ''}}">
      <view class="filter-row">
        <text class="filter-label">ä»·æ ¼åŒºé—´:</text>
        <input class="filter-input" placeholder="æœ€ä½ä»·" type="digit" bindinput="onFilterInput" data-field="minPrice" value="{{filters.minPrice}}" />
        <text class="separator">-</text>
        <input class="filter-input" placeholder="æœ€é«˜ä»·" type="digit" bindinput="onFilterInput" data-field="maxPrice" value="{{filters.maxPrice}}" />
      </view>
      
      <view class="filter-row">
        <text class="filter-label">PEåŒºé—´:</text>
        <input class="filter-input" placeholder="æœ€å°PE" type="digit" bindinput="onFilterInput" data-field="minPE" value="{{filters.minPE}}" />
        <text class="separator">-</text>
        <input class="filter-input" placeholder="æœ€å¤§PE" type="digit" bindinput="onFilterInput" data-field="maxPE" value="{{filters.maxPE}}" />
      </view>
      
      <view class="filter-row">
        <text class="filter-label">æœ€å°ROE:</text>
        <input class="filter-input" placeholder="ROE%" type="digit" bindinput="onFilterInput" data-field="minROE" value="{{filters.minROE}}" />
      </view>
      
      <view class="filter-row">
        <text class="filter-label">è¡Œä¸š:</text>
        <picker class="filter-picker" bindchange="onFilterInput" data-field="industry" range="{{industryOptions}}" value="{{filters.industry}}">
          <view class="picker-text">{{filters.industry || 'é€‰æ‹©è¡Œä¸š'}}</view>
        </picker>
      </view>
      
      <view class="filter-row">
        <text class="filter-label">æ¨èç­‰çº§:</text>
        <picker class="filter-picker" bindchange="onFilterInput" data-field="recommendation" range="{{recommendationOptions}}" value="{{filters.recommendation}}">
          <view class="picker-text">{{filters.recommendation || 'é€‰æ‹©ç­‰çº§'}}</view>
        </picker>
      </view>
      
      <view class="filter-row">
        <text class="filter-label">æœ€ä½è¯„åˆ†:</text>
        <input class="filter-input" placeholder="è¯„åˆ†" type="digit" bindinput="onFilterInput" data-field="minScore" value="{{filters.minScore}}" />
      </view>
      
      <view class="filter-actions">
        <button class="btn btn-secondary btn-small" bindtap="clearFilters">æ¸…ç©º</button>
        <button class="btn btn-primary btn-small" bindtap="applyFilters">åº”ç”¨</button>
      </view>
    </view>

    <!-- è‚¡ç¥¨åˆ—è¡¨ -->
    <view class="stock-list">
      <view wx:if="{{loading}}" class="loading">
        <view class="loading-spinner"></view>
        <text>åŠ è½½ä¸­...</text>
      </view>
      
      <view wx:elif="{{error}}" class="empty">
        <view class="empty-icon">ğŸ“Š</view>
        <text class="empty-text">{{errorMessage || 'æš‚æ— è‚¡ç¥¨æ•°æ®'}}</text>
        <button class="btn btn-primary import-btn" bindtap="importLatestData">
          <text class="btn-icon">â¬‡ï¸</text>
          <text>ä¸€é”®å¯¼å…¥è‚¡ç¥¨æ•°æ®</text>
        </button>
        <view class="import-tips">
          <text>â€¢ å®æ—¶è·å–æœ€æ–°è‚¡ä»·å’Œè´¢åŠ¡æ•°æ®</text>
          <text>â€¢ åŒ…å«è€åˆ˜è¯„åˆ†å’ŒæŠ•èµ„å»ºè®®</text>
          <text>â€¢ æ”¯æŒAè‚¡å’Œæ¸¯è‚¡å¸‚åœº</text>
        </view>
      </view>
      
      <view wx:elif="{{stockList.length === 0}}" class="empty">
        <view class="empty-icon">ğŸ“Š</view>
        <text class="empty-text">å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æš‚æ— æ•°æ®</text>
        <button class="btn btn-secondary" bindtap="clearFilters">æ¸…é™¤ç­›é€‰</button>
        <button class="btn btn-primary import-btn" bindtap="importLatestData">
          <text class="btn-icon">â¬‡ï¸</text>
          <text>å¯¼å…¥æ›´å¤šæ•°æ®</text>
        </button>
      </view>
      
      <view wx:else>
        <!-- æ•°æ®æ“ä½œæ  -->
        <view class="data-actions">
          <view class="data-summary">
            <text class="summary-text">å·²åŠ è½½ {{stockList.length}} / {{totalCount}} åªè‚¡ç¥¨</text>
          </view>
          <button class="btn btn-outline refresh-btn" bindtap="importLatestData">
            <text class="btn-icon">ğŸ”„</text>
            <text>åˆ·æ–°æ•°æ®</text>
          </button>
        </view>

        <view class="stock-item" wx:for="{{stockList}}" wx:key="code" bindtap="viewStockDetail" data-stock="{{item}}">
          <view class="stock-info">
            <view class="stock-name-row">
              <view class="stock-name">{{item.name}}</view>
              <view class="stock-code">{{item.code}}</view>
            </view>
            <view class="stock-tags">
              <text class="tag tag-info" wx:if="{{item.industry}}">{{item.industry}}</text>
              <text class="score {{item.scoreClass}}">{{item.displayScore}}åˆ†</text>
              <text class="tag {{item.recommendationClass}}" wx:if="{{item.displayRecommendation}}">{{item.displayRecommendation}}</text>
            </view>
            <view class="stock-metrics" wx:if="{{item.pe_ratio || item.roe}}">
              <text class="metric" wx:if="{{item.pe_ratio}}">PE: {{item.pe_ratio}}</text>
              <text class="metric" wx:if="{{item.roe}}">ROE: {{item.roe}}%</text>
            </view>
          </view>
          
          <view class="stock-price">
            <view class="price {{item.changeClass}}">
              Â¥{{item.displayPrice}}
            </view>
            <view class="change {{item.changeClass}}">
              {{item.displayChange >= 0 ? '+' : ''}}{{item.displayChange}}%
            </view>
            <view class="recommendation {{item.recommendationClass}}">
              {{item.displayRecommendation}}
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- åˆ·æ–°æç¤º -->
    <view wx:if="{{refreshing}}" class="refresh-indicator">
      <text>åˆ·æ–°ä¸­...</text>
    </view>
  </view>
</view>